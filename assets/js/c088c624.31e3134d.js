"use strict";(self.webpackChunkreact_navigation_website_next=self.webpackChunkreact_navigation_website_next||[]).push([[34840],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return f}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),l=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(u.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},v=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(n),v=r,f=p["".concat(u,".").concat(v)]||p[v]||d[v]||i;return n?a.createElement(f,o(o({ref:t},c),{},{components:n})):a.createElement(f,o({ref:t},c))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=v;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s[p]="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}v.displayName="MDXCreateElement"},85162:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(67294),r=n(86010),i={tabItem:"tabItem_Ymn6"};function o(e){var t=e.children,n=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i.tabItem,o),hidden:n},t)}},74866:function(e,t,n){n.d(t,{Z:function(){return w}});var a=n(83117),r=n(67294),i=n(86010),o=n(12466),s=n(16550),u=n(91980),l=n(67392),c=n(50012);function p(e){return function(e){return r.Children.map(e,(function(e){if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))}(e).map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes,default:t.default}}))}function d(e){var t=e.values,n=e.children;return(0,r.useMemo)((function(){var e=null!=t?t:p(n);return function(e){var t=(0,l.l)(e,(function(e,t){return e.value===t.value}));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,n])}function v(e){var t=e.value;return e.tabValues.some((function(e){return e.value===t}))}function f(e){var t=e.queryString,n=void 0!==t&&t,a=e.groupId,i=(0,s.k6)(),o=function(e){var t=e.queryString,n=void 0!==t&&t,a=e.groupId;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:n,groupId:a});return[(0,u._X)(o),(0,r.useCallback)((function(e){if(o){var t=new URLSearchParams(i.location.search);t.set(o,e),i.replace(Object.assign({},i.location,{search:t.toString()}))}}),[o,i])]}function h(e){var t,n,a,i,o=e.defaultValue,s=e.queryString,u=void 0!==s&&s,l=e.groupId,p=d(e),h=(0,r.useState)((function(){return function(e){var t,n=e.defaultValue,a=e.tabValues;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!v({value:n,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+a.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}var r=null!=(t=a.find((function(e){return e.default})))?t:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:o,tabValues:p})})),m=h[0],g=h[1],b=f({queryString:u,groupId:l}),y=b[0],k=b[1],w=(t=function(e){return e?"docusaurus.tab."+e:null}({groupId:l}.groupId),n=(0,c.Nk)(t),a=n[0],i=n[1],[a,(0,r.useCallback)((function(e){t&&i.set(e)}),[t,i])]),N=w[0],S=w[1],E=function(){var e=null!=y?y:N;return v({value:e,tabValues:p})?e:null}();return(0,r.useLayoutEffect)((function(){E&&g(E)}),[E]),{selectedValue:m,selectValue:(0,r.useCallback)((function(e){if(!v({value:e,tabValues:p}))throw new Error("Can't select invalid tab value="+e);g(e),k(e),S(e)}),[k,S,p]),tabValues:p}}var m=n(72389),g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){var t=e.className,n=e.block,s=e.selectedValue,u=e.selectValue,l=e.tabValues,c=[],p=(0,o.o5)().blockElementScrollPositionUntilNextRender,d=function(e){var t=e.currentTarget,n=c.indexOf(t),a=l[n].value;a!==s&&(p(t),u(a))},v=function(e){var t,n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":var a,r=c.indexOf(e.currentTarget)+1;n=null!=(a=c[r])?a:c[0];break;case"ArrowLeft":var i,o=c.indexOf(e.currentTarget)-1;n=null!=(i=c[o])?i:c[c.length-1]}null==(t=n)||t.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},t)},l.map((function(e){var t=e.value,n=e.label,o=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:function(e){return c.push(e)},onKeyDown:v,onClick:d},o,{className:(0,i.Z)("tabs__item",g.tabItem,null==o?void 0:o.className,{"tabs__item--active":s===t})}),null!=n?n:t)})))}function y(e){var t=e.lazy,n=e.children,a=e.selectedValue;if(n=Array.isArray(n)?n:[n],t){var i=n.find((function(e){return e.props.value===a}));return i?(0,r.cloneElement)(i,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},n.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a})})))}function k(e){var t=h(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",g.tabList)},r.createElement(b,(0,a.Z)({},e,t)),r.createElement(y,(0,a.Z)({},e,t)))}function w(e){var t=(0,m.Z)();return r.createElement(k,(0,a.Z)({key:String(t)},e))}},54264:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return u},default:function(){return f},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p}});var a=n(83117),r=n(80102),i=(n(67294),n(3905)),o=(n(74866),n(85162),["components"]),s={id:"state-persistence",title:"State persistence",sidebar_label:"State persistence"},u=void 0,l={unversionedId:"state-persistence",id:"version-3.x/state-persistence",title:"State persistence",description:"You may want to save the user's location in the app, so that they are immediately returned to the same location after the app is restarted.",source:"@site/versioned_docs/version-3.x/state-persistence.md",sourceDirName:".",slug:"/state-persistence",permalink:"/docs/3.x/state-persistence",draft:!1,editUrl:"https://github.com/react-navigation/react-navigation.github.io/edit/main/versioned_docs/version-3.x/state-persistence.md",tags:[],version:"3.x",frontMatter:{id:"state-persistence",title:"State persistence",sidebar_label:"State persistence"},sidebar:"version-3.x-docs",previous:{title:"Themes",permalink:"/docs/3.x/themes"},next:{title:"Redux integration",permalink:"/docs/3.x/redux-integration"}},c={},p=[{value:"Usage",id:"usage",level:2},{value:"Development Mode",id:"development-mode",level:3},{value:"Loading View",id:"loading-view",level:3},{value:"Warning: Serializable State",id:"warning-serializable-state",level:2},{value:"Warning: Route/Router definition changes",id:"warning-routerouter-definition-changes",level:2}],d={toc:p},v="wrapper";function f(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)(v,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"You may want to save the user's location in the app, so that they are immediately returned to the same location after the app is restarted."),(0,i.kt)("p",null,"This is especially valuable during development because it allows the developer to stay on the same screen when they refresh the app."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: This feature is currently considered experimental, because of the warnings listed at the end of this page. Use with caution!")),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("p",null,"You can enable persistence for your top-level navigator by rendering it with ",(0,i.kt)("inlineCode",{parentName:"p"},"persistNavigationState")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"loadNavigationState")," props:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"persistNavigationState")," is an async function that receives single argument - the navigation state object. The function should persist it."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"loadNavigationState")," is an async function that does the inverse - it should load the persisted navigation state and return a Promise that resolves with the navigation state object. If the function rejects, React Navigation will start as if no state was provided.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'const AppNavigator = createStackNavigator({...});\nconst persistenceKey = "persistenceKey"\nconst persistNavigationState = async (navState) => {\n  try {\n    await AsyncStorage.setItem(persistenceKey, JSON.stringify(navState))\n  } catch(err) {\n    // handle the error according to your needs\n  }\n}\nconst loadNavigationState = async () => {\n  const jsonString = await AsyncStorage.getItem(persistenceKey)\n  return JSON.parse(jsonString)\n}\n\nconst App = () => <AppNavigator persistNavigationState={persistNavigationState} loadNavigationState={loadNavigationState} />;\n')),(0,i.kt)("h3",{id:"development-mode"},"Development Mode"),(0,i.kt)("p",null,"This feature is particularly useful in development mode. You can enable it selectively using the following approach:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const AppNavigator = createStackNavigator({...});\nfunction getPersistenceFunctions() {\n  return __DEV__ ? {\n    persistNavigationState: ...,\n    loadNavigationState: ...,\n  } : undefined;\n}\nconst App = () => <AppNavigator {...getPersistenceFunctions()} />;\n")),(0,i.kt)("h3",{id:"loading-view"},"Loading View"),(0,i.kt)("p",null,"Because the state is loaded asynchronously, the app must render an empty/loading view for a moment before the ",(0,i.kt)("inlineCode",{parentName:"p"},"loadNavigationState")," function returns. To customize the loading view that is rendered during this time, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"renderLoadingExperimental")," prop:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"<AppNavigator\n  persistNavigationState={...}\n  loadNavigationState={...}\n  renderLoadingExperimental={() => <ActivityIndicator />}\n/>\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: This API may change in the future, which is why it is labeled experimental")),(0,i.kt)("h2",{id:"warning-serializable-state"},"Warning: Serializable State"),(0,i.kt)("p",null,"Each param, route, and navigation state must be fully serializable for this feature to work. Typically, you would serialize the state as a JSON string. This means that your routes and params must contain no functions, class instances, or recursive data structures."),(0,i.kt)("p",null,"If you need to modify the nav state object, you may do so in the ",(0,i.kt)("inlineCode",{parentName:"p"},"loadNavigationState")," / ",(0,i.kt)("inlineCode",{parentName:"p"},"persistNavigationState")," functions, but note that if your ",(0,i.kt)("inlineCode",{parentName:"p"},"loadNavigationState")," provides an invalid object (an object from which the navigation state cannot be recovered), React Navigation may not be able to handle the situation gracefully."),(0,i.kt)("h2",{id:"warning-routerouter-definition-changes"},"Warning: Route/Router definition changes"),(0,i.kt)("p",null,"When your application code changes to support new routes or different routers for a given route in your navigation state, the app may break when presented with the old navigation state."),(0,i.kt)("p",null,"This may happen regularly during development as you re-configure your routes and navigator hierarchy. But it also may happen in production when you release a new version of your app!"),(0,i.kt)("p",null,"The conservative behavior is to wipe the navigation state when the app has been updated. The easiest way to do this is to refer to a different persistence key for each version that you release to users."),(0,i.kt)("p",null,"React Navigation uses React's ",(0,i.kt)("inlineCode",{parentName:"p"},"componentDidCatch")," functionality to attempt to mitigate crashes caused by route definition changes, but this is considered experimental and may not catch all errors."))}f.isMDXComponent=!0}}]);